(function(){var a=null;(function(){var d,c={}.hasOwnProperty,b=[].slice;if(((d=this.google)!=a?d.maps:void 0)!=a){this.OverlappingMarkerSpiderfier=function(){function j(k,q){var l,n,p,o,r=this;this.map=k;q==a&&(q={});for(l in q){c.call(q,l)&&(n=q[l],this[l]=n)}this.m=new this.constructor.c(this.map);this.i();this.b={};o=["click","zoom_changed","maptypeid_changed"];n=0;for(p=o.length;n<p;n++){l=o[n],e.addListener(this.map,l,function(){return r.unspiderfy()})}}var e,i,s,h,f,m,g;m=j.prototype;m.VERSION="0.2.6";i=google.maps;e=i.event;f=i.MapTypeId;g=2*Math.PI;m.keepSpiderfied=!1;m.markersWontHide=!1;m.markersWontMove=!1;m.nearbyDistance=20;m.circleSpiralSwitchover=9;m.circleFootSeparation=23;m.circleStartAngle=g/12;m.spiralFootSeparation=26;m.spiralLengthStart=11;m.spiralLengthFactor=4;m.spiderfiedZIndex=1000;m.usualLegZIndex=10;m.highlightedLegZIndex=20;m.legWeight=1.5;m.legColors={usual:{},highlighted:{}};h=m.legColors.usual;s=m.legColors.highlighted;h[f.HYBRID]=h[f.SATELLITE]="#fff";s[f.HYBRID]=s[f.SATELLITE]="#f00";h[f.TERRAIN]=h[f.ROADMAP]="#444";s[f.TERRAIN]=s[f.ROADMAP]="#f00";m.i=function(){this.a=[];this.f=[]};m.addMarker=function(k){var n,l=this;if(k._oms!=a){return this}k._oms=!0;n=[e.addListener(k,"click",function(){return l.B(k)})];this.markersWontHide||n.push(e.addListener(k,"visible_changed",function(){return l.k(k,!1)}));this.markersWontMove||n.push(e.addListener(k,"position_changed",function(){return l.k(k,!0)}));this.f.push(n);this.a.push(k);return this};m.k=function(k,l){if(k._omsData!=a&&(l||!k.getVisible())&&!(this.p!=a||this.q!=a)){return this.F(l?k:a)}};m.getMarkers=function(){return this.a.slice(0)};m.removeMarker=function(k){var q,l,n,p,o;k._omsData!=a&&this.unspiderfy();q=this.h(this.a,k);if(0>q){return this}n=this.f.splice(q,1)[0];p=0;for(o=n.length;p<o;p++){l=n[p],e.removeListener(l)}delete k._oms;this.a.splice(q,1);return this};m.clearMarkers=function(){var k,r,l,o,q,p,t,n;this.unspiderfy();n=this.a;k=o=0;for(p=n.length;o<p;k=++o){l=n[k];r=this.f[k];q=0;for(t=r.length;q<t;q++){k=r[q],e.removeListener(k)}delete l._oms}this.i();return this};m.addListener=function(k,o){var l,n;((n=(l=this.b)[k])!=a?n:l[k]=[]).push(o);return this};m.removeListener=function(k,n){var l;l=this.h(this.b[k],n);0>l||this.b[k].splice(l,1);return this};m.clearListeners=function(k){this.b[k]=[];return this};m.trigger=function(){var k,q,l,n,p,o;q=arguments[0];k=2<=arguments.length?b.call(arguments,1):[];q=(l=this.b[q])!=a?l:[];o=[];n=0;for(p=q.length;n<p;n++){l=q[n],o.push(l.apply(a,k))}return o};m.r=function(k,q){var l,n,p,o,r;p=this.circleFootSeparation*(2+k)/g;n=g/k;r=[];for(l=o=0;0<=k?o<k:o>k;l=0<=k?++o:--o){l=this.circleStartAngle+l*n,r.push(new i.Point(q.x+p*Math.cos(l),q.y+p*Math.sin(l)))}return r};m.s=function(k,q){var l,o,p,r,n;p=this.spiralLengthStart;l=0;n=[];for(o=r=0;0<=k?r<k:r>k;o=0<=k?++r:--r){l+=this.spiralFootSeparation/p+0.0005*o,o=new i.Point(q.x+p*Math.cos(l),q.y+p*Math.sin(l)),p+=g*this.spiralLengthFactor/l,n.push(o)}return n};m.B=function(v){var t,w,q,u,r,o,p,k,n;t=v._omsData!=a;(!t||!this.keepSpiderfied)&&this.unspiderfy();if(t||this.map.getStreetView().getVisible()){return this.trigger("click",v)}u=[];r=[];o=this.nearbyDistance*this.nearbyDistance;q=this.j(v.position);n=this.a;p=0;for(k=n.length;p<k;p++){t=n[p],t.getVisible()&&t.map!=a&&(w=this.j(t.position),this.n(w,q)<o?u.push({v:t,l:w}):r.push(t))}return 1===u.length?this.trigger("click",v):this.C(u,r)};m.u=function(k){var l=this;return{d:function(){return k._omsData.e.setOptions({strokeColor:l.legColors.highlighted[l.map.mapTypeId],zIndex:l.highlightedLegZIndex})},g:function(){return k._omsData.e.setOptions({strokeColor:l.legColors.usual[l.map.mapTypeId],zIndex:l.usualLegZIndex})}}};m.C=function(z,x){var A,y,w,v,t,u,q,r,l,p;this.p=!0;p=z.length;A=this.z(function(){var k,n,o;o=[];k=0;for(n=z.length;k<n;k++){r=z[k],o.push(r.l)}return o}());v=p>=this.circleSpiralSwitchover?this.s(p,A).reverse():this.r(p,A);A=function(){var o,C,B,D=this;B=[];o=0;for(C=v.length;o<C;o++){w=v[o],y=this.A(w),l=this.w(z,function(k){return D.n(k.l,w)}),q=l.v,u=new i.Polyline({map:this.map,path:[q.position,y],strokeColor:this.legColors.usual[this.map.mapTypeId],strokeWeight:this.legWeight,zIndex:this.usualLegZIndex}),q._omsData={D:q.position,e:u},this.legColors.highlighted[this.map.mapTypeId]!==this.legColors.usual[this.map.mapTypeId]&&(t=this.u(q),q._omsData.t={d:e.addListener(q,"mouseover",t.d),g:e.addListener(q,"mouseout",t.g)}),q.setPosition(y),q.setZIndex(Math.round(this.spiderfiedZIndex+w.y)),B.push(q)}return B}.call(this);delete this.p;this.o=!0;return this.trigger("spiderfy",A,x)};m.unspiderfy=function(k){var r,l,t,q,p,n,o;k==a&&(k=a);if(this.o==a){return this}this.q=!0;q=[];t=[];o=this.a;p=0;for(n=o.length;p<n;p++){l=o[p],l._omsData!=a?(l._omsData.e.setMap(a),l!==k&&l.setPosition(l._omsData.D),l.setZIndex(a),r=l._omsData.t,r!=a&&(e.removeListener(r.d),e.removeListener(r.g)),delete l._omsData,q.push(l)):t.push(l)}delete this.q;delete this.o;this.trigger("unspiderfy",q,t);return this};m.n=function(k,n){var l,o;l=k.x-n.x;o=k.y-n.y;return l*l+o*o};m.z=function(k){var p,l,q,o,n;o=l=q=0;for(n=k.length;o<n;o++){p=k[o],l+=p.x,q+=p.y}k=k.length;return new i.Point(l/k,q/k)};m.j=function(k){return this.m.getProjection().fromLatLngToDivPixel(k)};m.A=function(k){return this.m.getProjection().fromDivPixelToLatLng(k)};m.w=function(k,t){var l,p,r,q,n,o;r=n=0;for(o=k.length;n<o;r=++n){if(q=k[r],q=t(q),!("undefined"!==typeof l&&l!==a)||q<p){p=q,l=r}}return k.splice(l,1)[0]};m.h=function(k,q){var l,n,p,o;if(k.indexOf!=a){return k.indexOf(q)}l=p=0;for(o=k.length;p<o;l=++p){if(n=k[l],n===q){return l}}return -1};j.c=function(k){return this.setMap(k)};j.c.prototype=new i.OverlayView;j.c.prototype.draw=function(){};return j}()}}).call(this)}).call(this);google.load("visualization","1",{packages:["corechart"]});window.onload=function(){var f={mapTypeId:google.maps.MapTypeId.ROADMAP,center:new google.maps.LatLng(-23.5505233,-46.6342982),zoom:12};var o={markersWontMove:true,markersWontHide:true};var g=new google.maps.InfoWindow();var b=new google.maps.Map(document.getElementById("map-wrapper"),f);var e=new OverlappingMarkerSpiderfier(b,o);e.addListener("click",function(p){g.setContent(p.desc);g.open(b,p)});e.addListener("spiderfy",function(q){for(var p=0;p<q.length;p++){q[p].setShadow(null)}g.close()});e.addListener("unspiderfy",function(q){for(var p=0;p<q.length;p++){q[p].setShadow(m)}});function i(p){if("cep" in p){return p.cep}var r=[];var s=[];var q=Object.keys(p);$.each(q,function(u,v){var t=["bairro","cidade","comunidade","conjunto","distrito","favela","jardim","loteamento","morro","recanto","sitio","subprefeitura","vila"];if($.inArray(v,t)!=-1){s=s.concat(p[v])}else{r=r.concat(p[v])}});if(r.length!=0){return r}else{return s}}function j(q){var p="ID: "+q.id+"<br>"+q.descricao+"<br>Orçado: "+q.orcado+"<br>Atualizado: "+q.atualizado+"<br>Empenhado: "+q.empenhado+"<br>Liquidado: "+q.liquidado+"<br>Órgão: "+q.orgao+"<br>Unidade: "+q.unidade+"<br>Função: "+q.funcao+"<br>Subfunção: "+q.subfuncao+"<br>Programa: "+q.programa;return p}function d(p){if(p.atualizado=="0,00"&&p.empenhado=="0,00"&&p.liquidado=="0,00"){return"red"}else{if(p.empenhado=="0,00"&&p.liquidado=="0,00"){return"yellow"}else{if(p.liquidado=="0,00"){return"green"}else{return"blue"}}}}var m=new google.maps.MarkerImage("https://www.google.com/intl/en_ALL/mapfiles/shadow50.png",new google.maps.Size(40,34),new google.maps.Point(0,0),new google.maps.Point(10,34));var k=[];var l='<table cellspacing="0"><tr><th scope="col" class="nobg">ID</th><th scope="col">Descrição</th><th scope="col">Orçado</th><th scope="col">Atualizado</th><th scope="col">Empenhado</th><th scope="col">Liquidado</th><th scope="col">Órgão</th></tr>';var n=l;function h(r,q,s){var p="<tr>";p+='<th scope="row" class="spec'+s+'">'+q.id+"</th>";if(r=="mapped"){p+='<td class="'+s+'"><a onclick="gotoMarker('+(k.length-1)+')">'+q.descricao+"</a></td>"}else{p+='<td class="'+s+'">'+q.descricao+"</td>"}p+='<td class="'+s+'">'+q.orcado+"</td>";p+='<td class="'+s+'">'+q.atualizado+"</td>";p+='<td class="'+s+'">'+q.empenhado+"</td>";p+='<td class="'+s+'">'+q.liquidado+"</td>";p+='<td class="'+s+'">'+q.orgao+"</td>";p+="</tr>";if(r=="mapped"){l+=p}else{n+=p}}function c(r){var p="",q="";$.each(r,function(t,v){if(Object.keys(v.coordenadas).length!=0){var u=j(v);var s=d(v);$.each(i(v.coordenadas),function(y,x){var w=new google.maps.Marker({position:new google.maps.LatLng(x.localizacoes[0].lat,x.localizacoes[0].lng),map:b,shadow:m,icon:"img/pin-"+s+".png"});w.desc=u;e.addMarker(w);k.push(w);h("mapped",v,p)})}else{h("notmapped",v,q)}})}function a(y){var t={title:"Quantidade de cada tipo de despesa",colors:["#3FB1FC","#C9C3C3"],height:400};var r={title:"Distribuição de recursos por tipo de despesa",hAxis:{title:"Tipo",viewWindowMode:"pretty"},vAxis:{viewWindowMode:"pretty"},colors:["#C9C3C3","#3FB1FC"],isStacked:true,height:400};var x=[["Tipo","Quantidade"]];var w=[["Varíavel","Não Mapeado","Mapeado"]];var s=y.tipo_1;var q=y.tipo_2;var p=y.tipo_3;var A=y.tipo_4;x.push(["Mapeado",p.quantidade+A.quantidade]);x.push(["Não Mapeado",s.quantidade+q.quantidade]);w.push(["Orçado",s.orcado+q.orcado,p.orcado+A.orcado]);w.push(["Atualizado",s.atualizado+q.atualizado,p.atualizado+A.atualizado]);w.push(["Empenhado",s.empenhado+q.empenhado,p.empenhado+A.empenhado]);w.push(["Liquidado",s.liquidado+q.liquidado,p.liquidado+A.liquidado]);var x=google.visualization.arrayToDataTable(x);var w=google.visualization.arrayToDataTable(w);var z=new google.visualization.NumberFormat({prefix:"R$"});z.format(w,1);z.format(w,2);var v=new google.visualization.PieChart(document.getElementById("chart-quantity-wrapper"));var u=new google.visualization.ColumnChart(document.getElementById("chart-values-wrapper"));v.draw(x,t);u.draw(w,r)}$.getJSON(path+"geocoded.json",function(p){c(p.data);$("#mapped-list-wrapper").html(l+"</table>");$("#notmapped-list-wrapper").html(n+"</table>");a(p.metadata)});window.markersArray=k;window.map=b};function gotoMarker(a){map.setCenter(new google.maps.LatLng(markersArray[a].position.lat(),markersArray[a].position.lng()));google.maps.event.trigger(markersArray[a],"click");$("html, body").animate({scrollTop:$("#map-wrapper").offset().top},"slow")};
